<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Guess Game Demo</title>
    <link rel="stylesheet" href="css/styles.css" media="screen" title="no title" charset="utf-8">
  </head>
  <body>
    <div class="header">
      <h1 class="sub-heading">Taylor's Guessing Game</h1>
    </div>

    <div class="push">
      <!-- this is empty to compensate for the header -->
    </div>

    <div>
      <h1 class="" id="userName"></h1>
    </div>

    <div>
      <h1 class="" id="question"> </h1>
      <h2 class="" id="answer"> </h2>
    </div>

    <div>
      <form action="" id="userAnswerForm" class="form-field">
        <input type="text" class="txt-field-style" name="userAnswer" id="userAnswer" placeholder="Put Your Answer Here"><br />
        <input type="button" class="btn-style" id="userSubmitButton" onclick = "onSubmitAnswer()" value="Submit Answer">
        <input type="button" class="btn-style" id="nextQuestionButton" onclick = "displayNextQuestion()" value="Next Question" style="display:none">
      </form>
    </div>

    <script type="text/javascript">
      var userName, answer = '';
      var questions, game, currentQuestion;

      //udpates page with text
      var displayOnPage = function(elmId,msg){
        document.getElementById(elmId).innerHTML = msg;
      };

      //grabs the users answer and then checks value.
      var onSubmitAnswer = function(event){
        answer = document.getElementById('userAnswer').value;
        console.log("The answer from button submit " + answer);

        /*
        if userName is undefined, we must be at the beginning of our game.
        lets run the getName() function which will set the userName param,
        build our questions and then start the game.
        I'm not sure if this is the bet way. It feels really sloppy.
        */

        if (userName === undefined) {
          getName(answer);
          nameQuestion.checkAnswer(answer);
          document.getElementById('userAnswer').value = ""; //clear the input field
        } else {
          game.currentQuestion.checkAnswer(answer);
          showNextButton();
        }
      };

      var displayNextQuestion = function(event){
        game.nextQuestion(); //show next question
        game.clearAnswer(); //clear previous answer
        showSubmitButton();
      };

      var showSubmitButton = function() {
        document.getElementById('userSubmitButton').style.display = "inline-block";
        document.getElementById('userAnswer').style.display= "inline-block";
        document.getElementById('nextQuestionButton').style.display = "none";
      };

      var showNextButton = function() {
        document.getElementById('nextQuestionButton').style.display = "inline-block";
        document.getElementById('userSubmitButton').style.display = "none";
        document.getElementById('userAnswer').value = ""; //clear the input field
        document.getElementById('userAnswer').style.display = "none";
      };

      //questions all have the same, repetitive properties. Lets build an object.
      var Question = function(question, answer, correctMsg, incorrectMsg){
        this.question = question;
        this.answer = answer;
        this.correctMsg = correctMsg;
        this.incorrectMsg = incorrectMsg;
      };

      Question.prototype.checkAnswer = function(userAnswer){
        console.log("The answer is: " + this.answer);
        if (answer.toLowerCase() === this.answer){
            displayOnPage('answer', this.correctMsg);
          } else {
            displayOnPage('answer', this.incorrectMsg);
          }
        };

        Question.prototype.displayQuestion = function () {
          displayOnPage('question', this.question);
        };

        //lets make a Game
        var Game = function(questions) {
          this.questions = questions;
          this.questionIdx = 0;
          this.currentQuestion = questions[0];
          this.questionLength = questions.length;
        };

        Game.prototype.nextQuestion = function () {
          if (this.questionIdx < this.questionLength - 1){
            this.questionIdx++;
            this.currentQuestion = this.questions[this.questionIdx];
            this.currentQuestion.displayQuestion();
          } else {
            displayOnPage('question', "Nice work, you're finished.");
          }
        };

        Game.prototype.clearAnswer = function () {
          displayOnPage('answer', "");
        };

        var generateQuestions = function () {
        // we want to build our questions, once we have a user.

        var questionOne = new Question(
          "Did I grow up in the Seattle area?",
          "yes",
          "Good Job, " + userName + "! I did grow up in the area.",
          "I'm sorry " + userName + ", but I did indeed grow up in the area."
        );

        var questionTwo = new Question(
          "Have I ever visited Africa?",
          "no",
          "Good Job, " + userName + "! I have never visited Africa.",
          "I'm sorry " + userName + ", but I have never been to Africa."
        );

        var questionThree = new Question(
          "Do I own an 80lb German Shepherd / Husky dog?",
          "yes",
          "Good Job, " + userName + "! I do have a huge German Shepherd / Husky dog.",
          "I'm sorry " + userName + ", but I do indeed own a huge German Shepherd / Husky dog."
        );

        var questionFour = new Question(
          // this is a tricky one.
          "Try to guess the number. It is between 1 and 10.",
          Math.floor(Math.random() * (10 - 1)) + 1, //took this from MDN -- generate our number
          "Good Job, " + userName + "! You got it right!",
          "" // we will use our new CheckAnswer() to generate this...
        );

        // This question is really bastardized. We need custom
        // checkAnswer() so we overrite the prototype.

        questionFour.checkAnswer = function(answer) {
          // questionFour needs a new checkAnswer() to account for the
          // answer being too high or too low
          console.log("The correctNum var is: " + this.answer);

          if (parseInt(answer) === this.answer) {
            displayOnPage('answer', this.correctMsg);
          } else if (parseInt(answer) > this.answer) {
            displayOnPage('answer', "Oops! Too high.");
          } else {
            displayOnPage('answer', "Oops! Too low.");
          }
        };

        return [questionOne, questionTwo, questionThree, questionFour];
      };

      // this is a little odd here, but I don't know how else to do it.
      // this question asks for our user name
      var nameQuestion = new Question(
        "What is your name?",
        true,
        "Hi " + userName + ". Let's play a game.",
        "" // there is no incorrect answer
      );

      nameQuestion.checkAnswer = function(answer) {
        // we just want to display the name
        console.log("The user's name is: " + answer);
        displayOnPage('userName', "Hi " + answer + ". Let's play a game.");
      };


      // var questions = generateQuestions();
      // var game = new Game(questions);
      var showNameQuestion = function(){
        // show the name question
        displayOnPage('question', nameQuestion.question);
      };

      var initGame = function(){
        //starts the game.
        game.currentQuestion.displayQuestion();
      };

      var getName = function(name) {
        //ask for name
        userName = name;

        // now that we have a name, we can build our questions and responses
        questions = generateQuestions();

        // build our game
        game = new Game(questions);

        //start our game.
        initGame();
      };

      showNameQuestion();
    </script>
  </body>
</html>
